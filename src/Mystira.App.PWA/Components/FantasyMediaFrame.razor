@namespace Mystira.App.PWA.Components

<div class="fantasy-frame @(Rounded ? "rounded" : string.Empty) @(Pulse ? "pulse" : string.Empty) kind-@MediaKind"
     style="--frame-color: @Color">
    <div class="fantasy-frame-inner">
        @ChildContent
    </div>

    <!-- Simple, thin SVG border with subtle grain and corner triangles -->
    <svg class="fantasy-frame-svg" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
        <defs>
            <!-- Grainy effect: low-contrast fractal noise masked to the border stroke -->
            <filter id="frame-grain" x="-10%" y="-10%" width="120%" height="120%">
                <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" seed="7" result="noise" />
                <feColorMatrix in="noise" type="saturate" values="0" result="mono" />
                <feComponentTransfer in="mono" result="softNoise">
                    <feFuncA type="table" tableValues="0 0.25 0.5 0.25 0" />
                </feComponentTransfer>
                <feBlend in="SourceGraphic" in2="softNoise" mode="multiply" />
            </filter>
        </defs>

        <!-- Outer stroke: positioned to sit EXACTLY at the edge or slightly outside -->
        <!-- Using x/y slightly negative and width/height slightly > 100 ensures the stroke is outside -->
        <rect x="-0.75" y="-0.75" width="101.5" height="101.5" rx="@(Rounded ? 9 : 0)" ry="@(Rounded ? 9 : 0)"
              fill="none" stroke="var(--frame-color)" stroke-width="1.5" vector-effect="non-scaling-stroke"/>

        <!-- Grain layer: duplicate stroke with low opacity and grain filter for subtle texture -->
        <rect x="-0.75" y="-0.75" width="101.5" height="101.5" rx="@(Rounded ? 9 : 0)" ry="@(Rounded ? 9 : 0)"
              fill="none" stroke="var(--frame-color)" stroke-width="2" opacity="0.25" filter="url(#frame-grain)"
              vector-effect="non-scaling-stroke" />

        <!-- Corner triangles: small, simple fills that may overlap the media slightly at corners -->
        <g fill="var(--frame-color)" opacity="0.85">
            <!-- top-left -->
            <polygon points="0,0 0,3 3,0" />
            <!-- top-right -->
            <polygon points="100,0 97,0 100,3" />
            <!-- bottom-left -->
            <polygon points="0,100 0,97 3,100" />
            <!-- bottom-right -->
            <polygon points="100,100 97,100 100,97" />
        </g>
    </svg>
</div>

@code {
    [Parameter]
    public string MediaKind { get; set; } = "image"; // image | video | audio

    [Parameter]
    public string Color { get; set; } = "#165668";

    [Parameter]
    public bool Rounded { get; set; } = true;

    [Parameter]
    public bool Pulse { get; set; } = true;

    [Parameter]
    public RenderFragment? ChildContent { get; set; }
}
