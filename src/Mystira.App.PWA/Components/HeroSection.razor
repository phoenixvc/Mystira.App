@* Hero Section Component *@
@inject IJSRuntime JSRuntime
@implements IAsyncDisposable

<div class="row">
    <div class="col-12 text-center mb-5 hero-section" style="position: relative; overflow: hidden;">
        <!-- Particle Background Canvas -->
        <canvas id="particle-canvas" class="particle-canvas" aria-hidden="true" 
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: auto;"></canvas>
        <div class="hero-content" style="position: relative; z-index: 1;">
            <h1 class="mystira-title mb-2">
                Mystira <span class="alpha-badge">ALPHA</span>
            </h1>
            <p class="mystira-tagline mb-4">Where imagination meets growth</p>
            <div class="hero-logo-container mb-4">
                <img src="icons/icon-512.png"
                     alt="Mystira - Where imagination meets growth"
                     width="600"
                     height="600"
                     class="hero-logo" />
            </div>
            @if (ShowDescription)
            {
                <p class="hero-description mb-4">
                    Bring stories to life with Mystira â€” an interactive adventure platform that helps children, parents, and group leaders explore imagination, teamwork, and growth through guided storytelling and play.
                </p>
                
                @if (ShowCallToActions)
                {
                    <div class="hero-cta-buttons d-flex gap-3 justify-content-center flex-wrap mb-4">
                        <a href="/signup" class="btn btn-primary-custom btn-lg px-5 py-3">
                            <i class="fas fa-rocket me-2"></i>Start Free Trial
                        </a>
                        <button class="btn btn-outline-primary btn-lg px-5 py-3" @onclick="OnWatchDemo">
                            <i class="fas fa-play-circle me-2"></i>Watch Demo (2 min)
                        </button>
                    </div>
                    
                    <!-- Trust Indicators -->
                    <div class="trust-badges">
                        <span class="trust-badge">
                            <i class="fas fa-shield-alt me-1"></i>Safe for Kids
                        </span>
                        <span class="trust-badge">
                            <i class="fas fa-ban me-1"></i>No Ads
                        </span>
                        <CoppaCompliancePill />
                    </div>
                }
            }
        </div>
    </div>
</div>

@code {
    [Parameter]
    public bool ShowDescription { get; set; } = false;
    
    [Parameter]
    public bool ShowCallToActions { get; set; } = false;
    
    [Parameter]
    public EventCallback OnWatchDemoClick { get; set; }
    
    private bool _particlesInitialized = false;
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_particlesInitialized)
        {
            _particlesInitialized = true;
            try
            {
                await JSRuntime.InvokeVoidAsync("MystiraParticles.init", "particle-canvas");
            }
            catch (Exception)
            {
                // Silently fail if JS interop is not available (e.g., during prerendering)
            }
        }
    }
    
    private async Task OnWatchDemo()
    {
        if (OnWatchDemoClick.HasDelegate)
        {
            await OnWatchDemoClick.InvokeAsync();
        }
    }
    
    public async ValueTask DisposeAsync()
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("MystiraParticles.destroy");
        }
        catch (Exception)
        {
            // Silently fail if JS interop is not available
        }
    }
}
