/* Component styles (consume global CSS vars; provide fallbacks) */

.roll-dice {
    font-size: 4rem;
    color: var(--primary-color);
    animation: rollAnimation 1s ease-in-out;
}

@keyframes rollAnimation {
    0% { transform: rotate(0deg) scale(1); }
    25% { transform: rotate(90deg) scale(1.2); }
    50% { transform: rotate(180deg) scale(1.1); }
    75% { transform: rotate(270deg) scale(1.2); }
    100% { transform: rotate(360deg) scale(1); }
}

.dice-shell {
  display: grid;
  gap: 1rem;
  background: var(--card, rgba(255,255,255,0.9));
  color: var(--fg, #111827);
  border-radius: 1.25rem;
  border: 1px solid var(--border, rgba(17,24,39,0.08));
  padding: 1rem;
  backdrop-filter: blur(12px);
  box-shadow: 0 10px 30px -15px var(--glow, rgba(52,211,153,0.35));
  transition: background .3s ease, color .3s ease, border-color .3s ease;
}

/* Controls section removed - dice is now clickable */

/* Dice grid */
.dice-area {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(88px, 1fr));
  gap: 0.85rem;
  align-items: center;
}

/* Parent supplies perspective & horizontal drift only */
.die {
  aspect-ratio: 1 / 1;
  perspective: 800px;
  transform: translateX(var(--drift, 0px));
  transition: transform .2s ease;
  will-change: transform;
  position: relative;
}

.die.clickable {
  cursor: pointer;
}

.die.clickable:hover {
  transform: translateX(var(--drift, 0px)) scale(1.05);
}

.die.clickable:active {
  transform: translateX(var(--drift, 0px)) scale(0.98);
}

/* Inner 3D layer rotates in 3D */
.die-3d {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  transform: rotateZ(var(--tilt, 0deg)) rotateX(var(--rx, 0deg)) rotateY(var(--ry, 0deg));
  transition: transform .3s ease;
  filter: drop-shadow(0 10px 16px rgba(0,0,0,.25));
}

/* Subtle thickness illusion */
.die-3d::before {
  content: "";
  position: absolute;
  inset: 6%;
  border-radius: 16px;
  background: linear-gradient(to bottom, rgba(255,255,255,.20), rgba(0,0,0,.15));
  transform: translateZ(-6px);
  pointer-events: none;
}

/* SVG face */
.die-svg {
  position: relative;
  width: 100%;
  height: 100%;
  display: block;
  backface-visibility: hidden;
}

.pip { fill: var(--pip, #111827); }

.big-num {
  font: 800 52px/1.1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
  fill: var(--die-num-color, #111827);
  paint-order: stroke;
  stroke: rgba(255,255,255,0.3);
  stroke-width: 1.5;
}

/* Dark mode number color */
html[data-theme="dark"] .big-num {
  fill: #111827;
  stroke: rgba(255,255,255,0.4);
}

.small-num {
  font: 600 12px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
  fill: var(--die-num-color, #111827);
}

html[data-theme="dark"] .small-num {
  fill: #111827;
}

/* Golden tube trail effect */
.die::before,
.die::after {
  content: '';
  position: absolute;
  pointer-events: none;
  border-radius: 50%;
  opacity: 0;
  z-index: -1;
}

.die::before {
  width: 120%;
  height: 120%;
  top: -10%;
  left: -10%;
  background: conic-gradient(
    from 0deg,
    transparent 0deg,
    rgba(255, 215, 0, 0.4) 60deg,
    rgba(218, 165, 32, 0.6) 120deg,
    transparent 180deg,
    rgba(255, 215, 0, 0.4) 240deg,
    rgba(218, 165, 32, 0.6) 300deg,
    transparent 360deg
  );
  filter: blur(8px);
}

.die::after {
  width: 140%;
  height: 140%;
  top: -20%;
  left: -20%;
  background: conic-gradient(
    from 180deg,
    transparent 0deg,
    rgba(255, 223, 0, 0.3) 45deg,
    rgba(255, 193, 7, 0.5) 90deg,
    transparent 135deg,
    rgba(255, 223, 0, 0.3) 180deg,
    rgba(255, 193, 7, 0.5) 225deg,
    transparent 270deg,
    rgba(255, 223, 0, 0.3) 315deg,
    transparent 360deg
  );
  filter: blur(12px);
}

/* Animate golden tubes when rolling */
.die.rolling::before {
  opacity: 1;
  animation: goldenTubeInner 0.9s cubic-bezier(.2,.6,.2,1);
}

.die.rolling::after {
  opacity: 1;
  animation: goldenTubeOuter 0.9s cubic-bezier(.2,.6,.2,1);
}

@keyframes goldenTubeInner {
  0% {
    opacity: 0;
    transform: scale(0.5) rotate(0deg);
  }
  20% {
    opacity: 1;
  }
  50% {
    transform: scale(1.2) rotate(360deg);
  }
  80% {
    opacity: 0.8;
    transform: scale(1) rotate(720deg);
  }
  100% {
    opacity: 0;
    transform: scale(0.8) rotate(1080deg);
  }
}

@keyframes goldenTubeOuter {
  0% {
    opacity: 0;
    transform: scale(0.6) rotate(0deg);
  }
  15% {
    opacity: 0.8;
  }
  50% {
    transform: scale(1.3) rotate(-270deg);
  }
  85% {
    opacity: 0.6;
    transform: scale(1.1) rotate(-540deg);
  }
  100% {
    opacity: 0;
    transform: scale(0.9) rotate(-810deg);
  }
}

/* Rolling: combine 3D tumble + wobble */
.die.rolling .die-3d {
  animation:
          tumble3d .9s cubic-bezier(.2,.6,.2,1),
          wobble   .55s cubic-bezier(.36,.07,.19,.97);
}

@keyframes tumble3d {
  0%   { transform: rotateZ(var(--tilt,0)) rotateX(0turn)   rotateY(0turn); }
  50%  { transform: rotateZ(calc(var(--tilt,0) + 8deg)) rotateX(.5turn) rotateY(.5turn); }
  100% { transform: rotateZ(var(--tilt,0)) rotateX(1turn)  rotateY(1turn); }
}

@keyframes wobble {
  10%  { transform: rotateZ(calc(var(--tilt, 0) - 8deg)); }
  30%  { transform: rotateZ(calc(var(--tilt, 0) + 6deg)); }
  50%  { transform: rotateZ(calc(var(--tilt, 0) - 4deg)); }
  70%  { transform: rotateZ(calc(var(--tilt, 0) + 2deg)); }
  100% { transform: rotateZ(var(--tilt, 0)); }
}

/* Summary & History */
.summary {
  display: flex;
  gap: .75rem;
  flex-wrap: wrap;
}
.sum-pill {
  display: inline-flex;
  gap: .5rem;
  align-items: baseline;
  border: 1px solid var(--border, rgba(17,24,39,0.08));
  padding: .5rem .75rem;
  border-radius: .9rem;
  background: rgba(255,255,255,0.06);
  color: var(--fg, #111827);
}
.sum-pill span { color: var(--muted, #6b7280); }

.history { margin-top: .5rem; }
.history summary {
  cursor: pointer;
  color: var(--muted, #6b7280);
}
.history ul {
  list-style: none;
  padding-left: 0;
  margin: .5rem 0 0;
  display: grid;
  gap: .35rem;
  font-size: .92rem;
}
.history li {
  display: flex;
  gap: .5rem;
  align-items: baseline;
  border-bottom: 1px dashed var(--border, rgba(17,24,39,0.12));
  padding-bottom: .35rem;
}
.history .time { color: var(--muted, #6b7280); }
.history .break { color: var(--border, rgba(17,24,39,0.12)); }

/* Responsive */
@media (max-width: 720px) {
  .dice-area {
    grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
    gap: 0.6rem;
  }
}

/* Compact variant when wrapped in <div class="dice-mini"> */
:host-context(.dice-mini) .dice-shell {
  gap: 0.5rem;
  padding: 0.5rem;
  border-radius: 0.9rem;
}
:host-context(.dice-mini) .dice-area {
  gap: 0.4rem;
  grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
}
:host-context(.dice-mini) .big-num { font-size: 40px; }
:host-context(.dice-mini) .small-num { font-size: 10px; }

/* === 3D Cube for d6 === */
.cube {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
}

/* Each face is a plane positioned around the center */
.face {
  position: absolute;
  inset: 0;
  display: block;
  backface-visibility: hidden;
}

/* Assume the die face is roughly 100x100; translateZ by half depth */
:root { --die-depth: 28px; } /* you can tune this in global CSS */

.face.front  { transform: rotateY(  0deg) translateZ(var(--die-depth)); }
.face.back   { transform: rotateY(180deg) translateZ(var(--die-depth)); }
.face.right  { transform: rotateY( 90deg) translateZ(var(--die-depth)); }
.face.left   { transform: rotateY(-90deg) translateZ(var(--die-depth)); }
.face.top    { transform: rotateX( 90deg) translateZ(var(--die-depth)); }
.face.bottom { transform: rotateX(-90deg) translateZ(var(--die-depth)); }

/* Add a bit of global shading for the cube */
.cube { filter: drop-shadow(0 10px 16px rgba(0,0,0,.25)); }

/* Use the existing .die and .die-3d rules to provide perspective + rotation:
   - .die gives perspective
   - .die-3d rotates (we'll rotate the .die-3d which contains the .cube)
*/

/* If you want even stronger depth, optionally give edges a subtle outline */
.face .die-svg rect {
  stroke: rgba(0,0,0,.12);
  stroke-width: 1;
}

/* Ensure rolling rotates the 3D wrapper so the cube tumbles */
.die.rolling .die-3d {
  animation: cubeTumble .9s cubic-bezier(.2,.6,.2,1);
}

/* Replace or keep your previous tumble3d; this one emphasizes 3D axes */
@keyframes cubeTumble {
  0%   { transform: rotateZ(var(--tilt,0)) rotateX(0turn)   rotateY(0turn); }
  50%  { transform: rotateZ(calc(var(--tilt,0) + 8deg)) rotateX(.5turn) rotateY(.5turn); }
  100% { transform: rotateZ(var(--tilt,0)) rotateX(1turn)  rotateY(1turn); }
}

/* === Golden Tube SVG Animations === */
.golden-tube {
  position: absolute;
  width: 150%;
  height: 150%;
  top: -25%;
  left: -25%;
  pointer-events: none;
  opacity: 0;
  z-index: -1;
  filter: drop-shadow(0 0 4px rgba(255, 215, 0, 0.6));
}

.golden-tube path {
  stroke-dasharray: 200;
  stroke-dashoffset: 200;
}

/* Animate tubes when rolling */
.die.rolling .golden-tube {
  opacity: 1;
}

.die.rolling .tube-1 {
  animation: tubeSwirl1 0.9s ease-out forwards;
}

.die.rolling .tube-2 {
  animation: tubeSwirl2 0.9s ease-out 0.1s forwards;
}

.die.rolling .tube-3 {
  animation: tubeSwirl3 0.9s ease-out 0.2s forwards;
}

.die.rolling .tube-1 path {
  animation: tubeDraw 0.7s ease-out forwards;
}

.die.rolling .tube-2 path {
  animation: tubeDraw 0.7s ease-out 0.1s forwards;
}

.die.rolling .tube-3 path {
  animation: tubeDraw 0.6s ease-out 0.15s forwards;
}

@keyframes tubeSwirl1 {
  0% {
    opacity: 0;
    transform: scale(0.3) rotate(0deg);
  }
  20% {
    opacity: 1;
  }
  60% {
    opacity: 0.9;
    transform: scale(1.1) rotate(180deg);
  }
  100% {
    opacity: 0;
    transform: scale(1.3) rotate(360deg);
  }
}

@keyframes tubeSwirl2 {
  0% {
    opacity: 0;
    transform: scale(0.4) rotate(45deg);
  }
  25% {
    opacity: 1;
  }
  65% {
    opacity: 0.85;
    transform: scale(1.05) rotate(-135deg);
  }
  100% {
    opacity: 0;
    transform: scale(1.25) rotate(-315deg);
  }
}

@keyframes tubeSwirl3 {
  0% {
    opacity: 0;
    transform: scale(0.5) rotate(-30deg);
  }
  30% {
    opacity: 0.9;
  }
  70% {
    opacity: 0.7;
    transform: scale(1) rotate(150deg);
  }
  100% {
    opacity: 0;
    transform: scale(1.2) rotate(330deg);
  }
}

@keyframes tubeDraw {
  0% {
    stroke-dashoffset: 200;
  }
  50% {
    stroke-dashoffset: 0;
  }
  100% {
    stroke-dashoffset: -200;
  }
}

/* Light mode specific golden colors */
.golden-tube path {
  filter: drop-shadow(0 0 2px rgba(255, 193, 7, 0.5));
}

/* Dark mode - make tubes more visible */
html[data-theme="dark"] .golden-tube path {
  filter: drop-shadow(0 0 4px rgba(255, 215, 0, 0.8));
}

html[data-theme="dark"] .golden-tube {
  filter: drop-shadow(0 0 6px rgba(255, 215, 0, 0.7));
}
